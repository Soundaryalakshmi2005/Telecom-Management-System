document.addEventListener("DOMContentLoaded", function () {
  // Tab navigation logic (same as before)
  const productsTab = document.getElementById("productsTab");
  const suppliersTab = document.getElementById("suppliersTab");
  const transactionsTab = document.getElementById("transactionsTab");

  const productsSection = document.getElementById("productsSection");
  const suppliersSection = document.getElementById("suppliersSection");
  const transactionsSection = document.getElementById("transactionsSection");

  function showSection(sectionToShow) {
    [productsSection, suppliersSection, transactionsSection].forEach(section => {
      section.classList.add("hidden");
    });
    sectionToShow.classList.remove("hidden");
  }

  productsTab.addEventListener("click", () => {
    showSection(productsSection);
    loadProducts();
  });
  suppliersTab.addEventListener("click", () => {
    showSection(suppliersSection);
    loadSuppliers();
  });
  transactionsTab.addEventListener("click", () => {
    showSection(transactionsSection);
    loadTransactions();
  });

  // Load data functions
  function loadProducts() {
    fetch("http://localhost:8080/api/products")
      .then(res => res.json())
      .then(data => {
        const tbody = document.querySelector("#productsTable tbody");
        tbody.innerHTML = "";
        data.forEach(p => {
          const row = `<tr>
            <td>${p.id}</td>
            <td>${p.name}</td>
            <td>${p.category}</td>
            <td>${p.stock}</td>
            <td>${p.reorderPoint}</td>
          </tr>`;
          tbody.innerHTML += row;
        });
      });
  }

  function loadSuppliers() {
    fetch("http://localhost:8080/api/suppliers")
      .then(res => res.json())
      .then(data => {
        const tbody = document.querySelector("#suppliersTable tbody");
        tbody.innerHTML = "";
        data.forEach(s => {
          const row = `<tr>
            <td>${s.id}</td>
            <td>${s.name}</td>
            <td>${s.contactNumber}</td>
            <td>${s.email}</td>
          </tr>`;
          tbody.innerHTML += row;
        });
      });
  }

  function loadTransactions() {
    fetch("http://localhost:8080/api/transactions")
      .then(res => res.json())
      .then(data => {
        const tbody = document.querySelector("#transactionsTable tbody");
        tbody.innerHTML = "";
        data.forEach(t => {
          const row = `<tr>
            <td>${t.id}</td>
            <td>${t.product ? t.product.name : "N/A"}</td>
            <td>${t.quantity}</td>
            <td>${t.type}</td>
            <td>${t.timestamp}</td>
          </tr>`;
          tbody.innerHTML += row;
        });
      });
  }

  // Handle Add Product form
  document.getElementById("productForm").addEventListener("submit", function (e) {
    e.preventDefault();
    const newProduct = {
      name: document.getElementById("prodName").value,
      category: document.getElementById("prodCategory").value,
      stock: parseInt(document.getElementById("prodStock").value),
      reorderPoint: parseInt(document.getElementById("prodReorder").value)
    };
    fetch("http://localhost:8080/api/products", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(newProduct)
    }).then(() => loadProducts());
    e.target.reset();
  });

  // Handle Add Supplier form
  document.getElementById("supplierForm").addEventListener("submit", function (e) {
    e.preventDefault();
    const newSupplier = {
      name: document.getElementById("supName").value,
      contactNumber: document.getElementById("supContact").value,
      email: document.getElementById("supEmail").value
    };
    fetch("http://localhost:8080/api/suppliers", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(newSupplier)
    }).then(() => loadSuppliers());
    e.target.reset();
  });

  // Handle Add Transaction form
  document.getElementById("transactionForm").addEventListener("submit", function (e) {
    e.preventDefault();
    const newTransaction = {
      product: { id: parseInt(document.getElementById("txnProductId").value) },
      quantity: parseInt(document.getElementById("txnQuantity").value),
      type: document.getElementById("txnType").value
    };
    fetch("http://localhost:8080/api/transactions", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(newTransaction)
    }).then(() => loadTransactions());
    e.target.reset();
  });

  // Load products first by default
  loadProducts();
});
